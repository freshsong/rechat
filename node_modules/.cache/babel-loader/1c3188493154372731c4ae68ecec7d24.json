{"ast":null,"code":"var _jsxFileName = \"/Users/apple/Desktop/reactchat/src/pages/ChatLobby.jsx\";\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { useAuthValue } from '../context/AuthProvider';\nimport { db, auth } from '../config/firebase';\nimport { addDoc, collection, query, orderBy, onSnapshot, where, deleteDoc, getDocs, serverTimestamp, QuerySnapshot } from 'firebase/firestore';\nimport { signOut, getAuth } from 'firebase/auth';\nconst ChatLobby = () => {\n  const [roomname, setRoomname] = useState(\"\");\n  const [roomList, setRoomList] = useState([]);\n  const {\n    nick,\n    userIcon,\n    email\n  } = useAuthValue();\n  const nav = useNavigate();\n  const user = auth.currentUser(); //로그인한 사용자 정보\n\n  const logout = () => {\n    signOut(auth).then(() => {\n      nav(\"/login\");\n    }).catch(err => console.error('로그아웃하다가 삑사리', err));\n  };\n\n  //방장 이름이 null값인 경우 채팅방 삭제\n  const handleDeleRoom = async () => {\n    try {\n      const dbref = collection(db, \"chatroom\");\n      //master값이 null일경우\n      const sql = query(dbref, where(\"master\", \"==\", null));\n      const querySnapshot = await getDocs(sql);\n      QuerySnapshot.forEach(async doc => {\n        await deleteDoc(doc.ref); //루프를 돌며 master가 null인 채팅룸 삭제\n      });\n    } catch (error) {\n      console.error(\"에러가 발생했습니다.\", error);\n    }\n  };\n\n  //db의 chatroom에서 읽기\n  const getRoom = () => {\n    const sql = query(collection(db, 'chatroom'), orderBy(\"timestamp\", \"desc\"));\n    onSnapshot(sql, res => {\n      const rooms = res.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setRoomList(rooms);\n    });\n  };\n  useEffect(() => {\n    handleDeleRoom();\n    getRoom();\n  }, []);\n\n  //db의 chatroom이라는 테이블에 쓰기\n  const handleMakeRoom = async e => {\n    e.preventDefault();\n    const dbref = collection(db, 'chatroom');\n    await addDoc(dbref, {\n      timestamp: serverTimestamp(),\n      title: roomname,\n      master: nick,\n      email\n    });\n    setRoomname(\"\");\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"header text-center mt-5 pt-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 8\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: userIcon,\n    alt: nick,\n    className: \"usericon\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 12\n    }\n  }), /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"text-center mt-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 12\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 45\n    }\n  }, nick), \"\\uB2D8 \\uD658\\uC601\\uD569\\uB2C8\\uB2E4.\"), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    onClick: logout,\n    className: \"btn btn-warning mt-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 12\n    }\n  }, \"\\uB85C\\uADF8\\uC544\\uC6C3\")), /*#__PURE__*/React.createElement(\"form\", {\n    className: \"makechat my-5\",\n    method: \"post\",\n    onSubmit: handleMakeRoom,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 8\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 12\n    }\n  }, \"\\uCC44\\uD305\\uBC29\\uAC1C\\uC124\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"\\uCC44\\uD305\\uB8F8\\uC774\\uB984\\uC744 \\uC4F0\\uC138\\uC694\",\n    name: \"roomname\",\n    value: roomname,\n    onChange: e => setRoomname(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 12\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    className: \"btn btn-primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 12\n    }\n  }, \"\\uCC44\\uD305\\uBC29\\uB9CC\\uB4E4\\uAE30\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 8\n    }\n  }, roomList && roomList.map((rs, index) => /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chatroom col-3\",\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: `/chat/${rs.id}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 24\n    }\n  }, rs.title), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 24\n    }\n  }, \"(\\uBC29\\uC7A5 : \", rs.master, \"\\uB2D8)\")))));\n};\nexport default ChatLobby;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","Link","useAuthValue","db","auth","addDoc","collection","query","orderBy","onSnapshot","where","deleteDoc","getDocs","serverTimestamp","QuerySnapshot","signOut","getAuth","ChatLobby","roomname","setRoomname","roomList","setRoomList","nick","userIcon","email","nav","user","currentUser","logout","then","catch","err","console","error","handleDeleRoom","dbref","sql","querySnapshot","forEach","doc","ref","getRoom","res","rooms","docs","map","id","data","handleMakeRoom","e","preventDefault","timestamp","title","master","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","src","alt","type","onClick","method","onSubmit","placeholder","name","value","onChange","target","rs","index","key","to"],"sources":["/Users/apple/Desktop/reactchat/src/pages/ChatLobby.jsx"],"sourcesContent":["import React, {useState, useEffect} from 'react'\r\nimport { useNavigate, Link} from 'react-router-dom'\r\nimport { useAuthValue } from '../context/AuthProvider'\r\nimport { db, auth } from '../config/firebase'\r\nimport { addDoc, \r\n   collection, \r\n   query, \r\n   orderBy, \r\n   onSnapshot, \r\n   where,\r\n   deleteDoc,\r\n   getDocs,\r\n   serverTimestamp,\r\n   QuerySnapshot} from 'firebase/firestore';\r\nimport { signOut, getAuth } from 'firebase/auth'\r\n\r\nconst ChatLobby = () => {\r\n  const [roomname, setRoomname] = useState(\"\");\r\n  const [roomList, setRoomList] = useState([]);\r\n  const { nick, userIcon, email } = useAuthValue();\r\n  const nav = useNavigate();\r\n  const user = auth.currentUser(); //로그인한 사용자 정보\r\n\r\n  const logout = () => {\r\n     signOut(auth)\r\n       .then(()=>{\r\n          nav(\"/login\");\r\n       })\r\n       .catch((err) => console.error('로그아웃하다가 삑사리', err));\r\n  }\r\n\r\n  //방장 이름이 null값인 경우 채팅방 삭제\r\n  const handleDeleRoom = async() => {\r\n    try{\r\n      const dbref = collection(db, \"chatroom\");\r\n      //master값이 null일경우\r\n      const sql = query(dbref, where(\"master\", \"==\", null));\r\n      const querySnapshot = await getDocs(sql);\r\n      QuerySnapshot.forEach(async (doc) => {\r\n         await deleteDoc(doc.ref); //루프를 돌며 master가 null인 채팅룸 삭제\r\n      });\r\n    }catch(error){\r\n      console.error(\"에러가 발생했습니다.\", error);\r\n    }\r\n  }\r\n\r\n\r\n  //db의 chatroom에서 읽기\r\n  const getRoom = () => {\r\n     const sql = query(collection(db, 'chatroom'), orderBy(\"timestamp\", \"desc\"));\r\n     onSnapshot(sql, (res) => {\r\n        const rooms =res.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data()\r\n        }));\r\n        setRoomList(rooms);\r\n     });\r\n  }\r\n  useEffect(()=>{\r\n     handleDeleRoom();\r\n     getRoom();\r\n  }, []);\r\n\r\n  //db의 chatroom이라는 테이블에 쓰기\r\n  const handleMakeRoom = async (e) => {\r\n     e.preventDefault();\r\n     const dbref = collection(db, 'chatroom');\r\n        await addDoc(dbref, {\r\n           timestamp: serverTimestamp(),\r\n           title: roomname,\r\n           master: nick,\r\n           email\r\n        });\r\n        setRoomname(\"\");\r\n  }\r\n\r\n  return (\r\n    <div className=\"container\">\r\n       <div className=\"header text-center mt-5 pt-3\">\r\n           <img src={userIcon} alt={nick} className=\"usericon\"/>\r\n           <h3 className=\"text-center mt-4\"><strong>{nick}</strong>님 환영합니다.</h3>\r\n           <button type=\"button\" onClick={logout} className=\"btn btn-warning mt-3\">로그아웃</button>\r\n       </div>\r\n       <form className=\"makechat my-5\" method=\"post\" onSubmit={handleMakeRoom}>\r\n           <h2 className=\"text-center\">채팅방개설</h2>\r\n           <input \r\n               type=\"text\"\r\n               placeholder=\"채팅룸이름을 쓰세요\"\r\n               name=\"roomname\"\r\n               value={roomname}\r\n               onChange={(e)=>setRoomname(e.target.value)}\r\n           />\r\n           <button type=\"submit\"\r\n                   className=\"btn btn-primary\"\r\n            >채팅방만들기</button>           \r\n       </form>\r\n       <div className=\"row\">\r\n           {\r\n              (roomList) && \r\n                 roomList.map((rs, index)=>(\r\n                    <div className=\"chatroom col-3\" key={index}>\r\n                       <Link to={`/chat/${rs.id}`}>{rs.title}</Link>\r\n                       <p>(방장 : {rs.master}님)</p>\r\n                    </div>  \r\n                 ))\r\n           }\r\n       </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ChatLobby"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}