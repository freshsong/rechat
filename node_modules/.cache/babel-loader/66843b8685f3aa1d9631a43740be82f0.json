{"ast":null,"code":"var _jsxFileName = \"/Users/apple/Desktop/reactchat/src/pages/ChatLobby.jsx\";\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { useAuthValue } from '../context/AuthProvider';\nimport { db, auth } from '../config/firebase';\nimport { addDoc, collection, query, orderBy, onSnapshot, where, serverTimestamp, deleteDoc, getDocs, doc, setDoc } from 'firebase/firestore';\nimport { signOut, getAuth, onAuthStateChanged } from 'firebase/auth';\nconst ChatLobby = () => {\n  const [roomname, setRoomname] = useState(\"\");\n  const [roomList, setRoomList] = useState([]);\n  const {\n    nick,\n    userIcon,\n    email\n  } = useAuthValue();\n  const nav = useNavigate();\n  const user = auth.currentUser; //로그인한 사용자 정보\n\n  /*\r\n  onAuthStateChanged( auth , user => { \r\n     const userRef = doc(db, \"activeUsers\", user.uid);\r\n     if(user){ //로그인 상태 - activeUser에다 로그인된 회원정보를 등록  \r\n       setDoc(userRef, {\r\n           uid: user.uid,\r\n           email: user.email,\r\n           nick: user.displayName,\r\n           uicon: user.photoURL,\r\n           lastLogin: new Date()\r\n       }, { merge: true})\r\n       .catch(error=> console.error(\"에러가 발생했습니다.\", error));\r\n     }else{  //로그아웃 상태 또는 삭제 - activeUser에 등록된 정보를 삭제\r\n        deleteDoc(userRef)\r\n       .catch(error=> console.error(\"에러가 발생했습니다.\", error));\r\n     }\r\n  });\r\n  */\n\n  const logout = () => {\n    signOut(auth).then(() => {\n      nav(\"/login\");\n    }).catch(err => console.error('로그아웃하다가 삑사리', err));\n  };\n\n  //방장이름이 null값인 경우 채팅방을 삭제\n  const handleDelRoom = async () => {\n    try {\n      const dbref = collection(db, \"chatroom\");\n      const sql = query(dbref, where(\"master\", \"==\", null));\n      const querySnapshot = await getDocs(sql);\n      querySnapshot.forEach(async doc => {\n        await deleteDoc(doc.ref); //루프를 돌며 master가 null인 채팅룸 삭제\n      });\n    } catch (error) {\n      console.error(\"에러가 발생했습니다.\", error);\n    }\n  };\n\n  //db의 chatroom에서 읽기\n  const getRoom = () => {\n    const sql = query(collection(db, 'chatroom'), orderBy(\"timestamp\", \"desc\"));\n    onSnapshot(sql, res => {\n      const rooms = res.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setRoomList(rooms);\n    });\n  };\n  useEffect(() => {\n    handleDelRoom();\n    getRoom();\n  }, []);\n\n  //db의 chatroom이라는 테이블에 쓰기\n  const handleMakeRoom = async e => {\n    e.preventDefault();\n    const dbref = collection(db, 'chatroom');\n    await addDoc(dbref, {\n      timestamp: serverTimestamp(),\n      title: roomname,\n      master: nick,\n      email\n    });\n    setRoomname(\"\");\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"header text-center mt-5 pt-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 8\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: userIcon,\n    alt: nick,\n    className: \"usericon\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 12\n    }\n  }), /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"text-center mt-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 12\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 45\n    }\n  }, nick), \"\\uB2D8 \\uD658\\uC601\\uD569\\uB2C8\\uB2E4.\"), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    onClick: logout,\n    className: \"btn btn-warning mt-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 12\n    }\n  }, \"\\uB85C\\uADF8\\uC544\\uC6C3\")), /*#__PURE__*/React.createElement(\"form\", {\n    className: \"makechat my-5\",\n    method: \"post\",\n    onSubmit: handleMakeRoom,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 8\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 12\n    }\n  }, \"\\uCC44\\uD305\\uBC29\\uAC1C\\uC124\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"\\uCC44\\uD305\\uB8F8\\uC774\\uB984\\uC744 \\uC4F0\\uC138\\uC694\",\n    name: \"roomname\",\n    value: roomname,\n    onChange: e => setRoomname(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 12\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    className: \"btn btn-primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 12\n    }\n  }, \"\\uCC44\\uD305\\uBC29\\uB9CC\\uB4E4\\uAE30\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 8\n    }\n  }, roomList && roomList.map((rs, index) => /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chatroom col-3\",\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: `/chat/${rs.id}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 24\n    }\n  }, rs.title), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 24\n    }\n  }, \"(\\uBC29\\uC7A5 : \", rs.master, \"\\uB2D8)\")))));\n};\nexport default ChatLobby;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","Link","useAuthValue","db","auth","addDoc","collection","query","orderBy","onSnapshot","where","serverTimestamp","deleteDoc","getDocs","doc","setDoc","signOut","getAuth","onAuthStateChanged","ChatLobby","roomname","setRoomname","roomList","setRoomList","nick","userIcon","email","nav","user","currentUser","logout","then","catch","err","console","error","handleDelRoom","dbref","sql","querySnapshot","forEach","ref","getRoom","res","rooms","docs","map","id","data","handleMakeRoom","e","preventDefault","timestamp","title","master","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","src","alt","type","onClick","method","onSubmit","placeholder","name","value","onChange","target","rs","index","key","to"],"sources":["/Users/apple/Desktop/reactchat/src/pages/ChatLobby.jsx"],"sourcesContent":["import React, {useState, useEffect} from 'react'\r\nimport { useNavigate, Link} from 'react-router-dom'\r\nimport { useAuthValue } from '../context/AuthProvider'\r\nimport { db, auth } from '../config/firebase'\r\nimport { addDoc, \r\n         collection, \r\n         query, \r\n         orderBy, \r\n         onSnapshot, \r\n         where,\r\n         serverTimestamp, \r\n         deleteDoc,\r\n         getDocs,\r\n         doc,\r\n         setDoc\r\n      } from 'firebase/firestore';\r\nimport { signOut, getAuth, onAuthStateChanged } from 'firebase/auth'\r\n\r\nconst ChatLobby = () => {\r\n  const [roomname, setRoomname] = useState(\"\");\r\n  const [roomList, setRoomList] = useState([]);\r\n  const { nick, userIcon, email } = useAuthValue();\r\n  const nav = useNavigate();\r\n  const user = auth.currentUser;  //로그인한 사용자 정보\r\n\r\n  /*\r\n  onAuthStateChanged( auth , user => { \r\n     const userRef = doc(db, \"activeUsers\", user.uid);\r\n     if(user){ //로그인 상태 - activeUser에다 로그인된 회원정보를 등록  \r\n       setDoc(userRef, {\r\n           uid: user.uid,\r\n           email: user.email,\r\n           nick: user.displayName,\r\n           uicon: user.photoURL,\r\n           lastLogin: new Date()\r\n       }, { merge: true})\r\n       .catch(error=> console.error(\"에러가 발생했습니다.\", error));\r\n     }else{  //로그아웃 상태 또는 삭제 - activeUser에 등록된 정보를 삭제\r\n        deleteDoc(userRef)\r\n       .catch(error=> console.error(\"에러가 발생했습니다.\", error));\r\n     }\r\n  });\r\n  */\r\n \r\n  const logout = () => {\r\n     signOut(auth)\r\n       .then(()=>{\r\n          nav(\"/login\");\r\n       })\r\n       .catch((err) => console.error('로그아웃하다가 삑사리', err));\r\n  }\r\n\r\n  //방장이름이 null값인 경우 채팅방을 삭제\r\n  const handleDelRoom = async() => {\r\n     try{\r\n        const dbref = collection(db, \"chatroom\");\r\n        const sql = query(dbref, where(\"master\", \"==\", null));\r\n        const querySnapshot = await getDocs(sql);\r\n        querySnapshot.forEach(async (doc) => {\r\n            await deleteDoc(doc.ref);  //루프를 돌며 master가 null인 채팅룸 삭제\r\n        });\r\n     }catch(error){\r\n        console.error(\"에러가 발생했습니다.\", error);\r\n     }  \r\n  }\r\n\r\n  //db의 chatroom에서 읽기\r\n  const getRoom = () => {\r\n     const sql = query(collection(db, 'chatroom'), orderBy(\"timestamp\", \"desc\"));\r\n     onSnapshot(sql, (res) => {\r\n        const rooms =res.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data()\r\n        }));\r\n        setRoomList(rooms);\r\n     });\r\n  }\r\n \r\n  useEffect(()=>{\r\n     handleDelRoom();\r\n     getRoom();\r\n  }, []);\r\n\r\n  //db의 chatroom이라는 테이블에 쓰기\r\n  const handleMakeRoom = async (e) => {\r\n     e.preventDefault();\r\n     const dbref = collection(db, 'chatroom');\r\n        await addDoc(dbref, {\r\n           timestamp: serverTimestamp(),\r\n           title: roomname,\r\n           master: nick,\r\n           email\r\n        });\r\n        setRoomname(\"\");\r\n  }\r\n\r\n  return (\r\n    <div className=\"container\">\r\n       <div className=\"header text-center mt-5 pt-3\">\r\n           <img src={userIcon} alt={nick} className=\"usericon\"/>\r\n           <h3 className=\"text-center mt-4\"><strong>{nick}</strong>님 환영합니다.</h3>\r\n           <button type=\"button\" onClick={logout} className=\"btn btn-warning mt-3\">로그아웃</button>\r\n       </div>\r\n       <form className=\"makechat my-5\" method=\"post\" onSubmit={handleMakeRoom}>\r\n           <h2 className=\"text-center\">채팅방개설</h2>\r\n           <input \r\n               type=\"text\"\r\n               placeholder=\"채팅룸이름을 쓰세요\"\r\n               name=\"roomname\"\r\n               value={roomname}\r\n               onChange={(e)=>setRoomname(e.target.value)}\r\n           />\r\n           <button type=\"submit\"\r\n                   className=\"btn btn-primary\"\r\n            >채팅방만들기</button>           \r\n       </form>\r\n       <div className=\"row\">\r\n           {\r\n              (roomList) && \r\n                 roomList.map((rs, index)=>(\r\n                    <div className=\"chatroom col-3\" key={index}>\r\n                       <Link to={`/chat/${rs.id}`}>{rs.title}</Link>\r\n                       <p>(방장 : {rs.master}님)</p>\r\n                    </div>  \r\n                 ))\r\n           }\r\n       </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ChatLobby"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}